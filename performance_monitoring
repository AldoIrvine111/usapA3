#!/bin/bash

VCGENCMD=/usr/bin/vcgencmd
PRINTF=/usr/bin/printf
EGREP=/bin/egrep
ECHO=/bin/echo

# Function to call when trap is executed
sigusr1(){
	$ECHO "Signal USR1 received, performance_monitoring script ending"
	exit 0
}

trap 'sigusr1' USR1

$ECHO "Starting performance data. PID: $$"
SECONDS=1

while true
do
	temp=$($VCGENCMD measure_temp | $EGREP -o  '[0-9]*\.[0-9]*')
	timestamp=$($ECHO "$SECONDS")
	$PRINTF "%-15s\t%5s\n" "$timestamp" "$temp" >> kernel_performance_data
	sleep 1
done

